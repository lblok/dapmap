(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&t(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function t(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();const r={},i={};i.startzoom=12;i.startlat=40.7381;i.startlng=-73.9423;i.colordefs={stabloss:["case",["==",["get","missing"],"True"],"#a7a7a7",["step",["get","stabloss"],"transparent",-9999,"transparent",-1,"#bd0026",-.95,"#fc4e2a",-.75,"#fd8d3c",-.5,"#feb24c",-.25,"#fed976",-.1,"#ffffcc"]],ppuval:["case",["==",["get","ppuval"],null],"transparent",["step",["get","ppuval"],"transparent",1e5,"#ffffcc",2e5,"#feb24c",35e4,"#fd8d3c",5e5,"#fc4e2a",75e4,"#bd0026",1e6,"#800026"]],violscore:["case",["==",["get","violscore"],null],"transparent",["step",["get","violscore"],"transparent",10,"#ffffcc",25,"#feb24c",50,"#fd8d3c",100,"#fc4e2a",200,"#bd0026",500,"#800026"]],evicscore:["case",["==",["get","evicscore"],null],"transparent",["step",["get","evicscore"],"transparent",5,"#ffffcc",20,"#feb24c",33,"#fd8d3c",50,"#fc4e2a",100,"#bd0026",150,"#800026"]]};i.label_layout_properties={visibility:"none","icon-image":"fake-icon","text-field":["get","label"],"text-font":["Open Sans Semibold"],"text-offset":[0,-1],"text-anchor":"top","text-size":27};i.taxlots_url="https://anhd-dap-maptiles.s3.us-west-1.amazonaws.com/allzooms.pmtiles";$(document).ready(function(){Promise.all([p("./data/council.json","json"),p("./data/council_centroids.json","json"),p("./data/boards.json","json"),p("./data/boards_centroids.json","json"),p("./data/zip.json","json"),p("./data/zip_centroids.json","json"),p("./images/1x1.png","image")]).then(function(o){f(o),y(),v(),T(),g(),console.log("%c DATA","color: green",r),console.log("%c CONFIG","color: blue",i)})});function g(){Cookies.get("dap-no-intro")||($("div#openModal.modalDialog").show(),location.href="#",location.href="#openModal",$("#toggleIntroCookie").on("change",function(){$(this).is(":checked")?Cookies.set("dap-no-intro","dap-no-intro",{expires:365,path:"/"}):Cookies.remove("dap-no-intro",{path:"/"})}))}function p(o,e){return new Promise(function(n,t){fetch(o).then(function(s){if(e==="csv")return s.text();if(e==="json")return s.json();if(e==="image")return s.blob()}).then(function(s){n(s)})})}function f(o){r.council=o[0],r.council_centroids=o[1],r.boards=o[2],r.boards_centroids=o[3],r.zip=o[4],r.zip_centroids=o[5],r.empty_glpyh=o[6]}function y(){$("button.layerbtn").not(".geolayer").on("click",function(){const o=$(this),e=o.data("layer");o.hasClass("selected")?(o.removeClass("selected"),i.map.setLayoutProperty("taxlots-id","visibility","none")):($("button.layerbtn").removeClass("selected"),o.addClass("selected"),i.map.setPaintProperty("taxlots-id","fill-color",i.colordefs[e]),i.map.fire("closeAllPopups"),i.map.getLayoutProperty("taxlots-id","visibility")==="none"&&i.map.setLayoutProperty("taxlots-id","visibility","visible"))}),$("button.geolayer").on("click",function(){const o=$(this),e=o.data("layer");o.hasClass("btnactive")?(o.removeClass("btnactive"),i.map.setLayoutProperty(e,"visibility","none"),i.map.setLayoutProperty(`${e}-labels`,"visibility","none")):(o.addClass("btnactive"),i.map.setLayoutProperty(e,"visibility","visible"),i.map.setLayoutProperty(`${e}-labels`,"visibility","visible"))}),$("select.geoselect").on("change",function(){const o=$(this),e=o.data("layer"),n=o.val();["council","boards","zip"].forEach(function(c){e!=c&&($(`button.layerbtn[data-layer=${c}`).removeClass("btnactive"),i.map.setLayoutProperty(c,"visibility","none"),$(`select.geoselect[data-layer=${c}]`).val("0"))});const t=i.map.getLayoutProperty(e,"visibility");$(`button.layerbtn[data-layer=${e}`).addClass("btnactive"),t==="none"&&i.map.setLayoutProperty(e,"visibility","visible");const a=r[e].features.filter(function(c){return c.properties.dist==n})[0].geometry.coordinates,l=u(a);i.map.fitBounds(l)}),$("div.help-tip").on("click",function(){$("div.help-tip div.tip-outer").hide(),$(this).find("div.tip-outer").show()}),$("div.tip-outer div.close-tip").on("click",function(){return $(this).parent().hide(),!1}),$(".modalDialog a.close").on("click",function(){$(".modalDialog").hide()})}function v(){i.map=new maplibregl.Map({container:"map",hash:"view",style:{version:8,sources:{dark_custom_basemap:{type:"raster",tiles:["https://api.mapbox.com/styles/v1/lblok/cjk4889sb29b12splkdw0pzop/tiles/512/{z}/{x}/{y}?access_token=pk.eyJ1IjoibGJsb2siLCJhIjoiY2o3djQ2ODd4MnVjMjJwbjBxZWZtZDB2ZiJ9.4gctlFUX_n0BzOAwbuL2aw"],tileSize:512,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}},glyphs:"https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf",layers:[{id:"dark_custom_basemap-id",type:"raster",source:"dark_custom_basemap"}]},center:[i.startlng,i.startlat],zoom:i.startzoom});let o=new pmtiles.Protocol;maplibregl.addProtocol("pmtiles",o.tile),i.map.on("load",function(){b()})}function b(){i.map.addSource("taxlots",{type:"vector",url:`pmtiles://${i.taxlots_url}`,minzoom:9,maxzoom:22}),i.map.addSource("council",{type:"geojson",data:r.council}),i.map.addSource("council_centroids",{type:"geojson",data:r.council_centroids}),i.map.addSource("boards",{type:"geojson",data:r.boards}),i.map.addSource("boards_centroids",{type:"geojson",data:r.boards_centroids}),i.map.addSource("zip",{type:"geojson",data:r.zip}),i.map.addSource("zip_centroids",{type:"geojson",data:r.zip_centroids}),i.map.addLayer({id:"taxlots-id",source:"taxlots","source-layer":"taxlots_4326",type:"fill",paint:{"fill-opacity":.8,"fill-color":i.colordefs.stabloss}}),i.map.addLayer({id:"council",type:"line",source:"council",layout:{visibility:"none"},paint:{"line-color":"#fff","line-width":2}}),i.map.addLayer({id:"boards",type:"line",source:"boards",layout:{visibility:"none"},paint:{"line-color":"#e87fe4","line-width":2}}),i.map.addLayer({id:"zip",type:"line",source:"zip",layout:{visibility:"none"},paint:{"line-color":"#9ce976","line-width":2}}),i.map.on("mouseenter","taxlots-id",()=>{i.map.getCanvas().style.cursor="crosshair"}),i.map.on("mouseleave","taxlots-id",()=>{i.map.getCanvas().style.cursor="default"}),i.map.on("click","taxlots-id",o=>{const e=i.map.queryRenderedFeatures(o.point,{layers:["taxlots-id"]});if(e.length>0){const{state:n,properties:t}=e[0];let s=$('<div class="popup"></div>');$('<button class="maplibregl-popup-close-button"></button>').appendTo(s);let a=$('<div class="popup-content-wrapper">').appendTo(s);switch($('<div class="popup-header"></div>').appendTo(a).html(`<h2>${t.address}</h2>`),$('<div class="popup-content"></div>').appendTo(a).html(`<h3>${t.borough} ${t.zipcode}</h3><span class="bbl">BBL: ${t.bbl}</span>`),$("button.layerbtn.selected").data("layer")){case"stabloss":h(t,s);break;case"ppuval":_(t,s);break;case"violscore":x(t,s);break;case"evicscore":P(t,s);break;default:console.log("Missing a layer type!")}$(`<strong><a class="dap-link" target="_blank" href="https://portal.displacementalert.org/property/${t.bbl}">DAP Portal</a><strong>`).appendTo(s);const m=new maplibregl.Popup().setLngLat(o.lngLat).setHTML(s.html()).addTo(i.map);i.map.on("closeAllPopups",function(){m.remove()})}}),i.map.loadImage("./images/1x1.png",(o,e)=>{if(o)throw o;i.map.addImage("fake-icon",e),i.map.addLayer({id:"council-labels",type:"symbol",source:"council_centroids",layout:i.label_layout_properties,paint:{"text-color":"#FFF"}}),i.map.addLayer({id:"boards-labels",type:"symbol",source:"boards_centroids",layout:i.label_layout_properties,paint:{"text-color":"#e87fe4"}}),i.map.addLayer({id:"zip-labels",type:"symbol",source:"zip_centroids",layout:i.label_layout_properties,paint:{"text-color":"#9ce976"}})})}function h(o,e){let n=$('<div class="popup-content"></div>').appendTo(e),t=o.numbldgs||"N/A";n.html(`<p>Number of Buildings: <strong>${t}</strong></p>`),n=$('<div class="popup-content"></div>').appendTo(e),t=o.unitsres||"0",n.html(`<p>Residential Units: <strong>${t}</strong></p>`),n=$('<div class="popup-content"></div>').appendTo(e),t=o.yearbuilt||"N/A",n.html(`<p>Year Built: <strong>${t}</strong></p>`),n=$('<div class="popup-content"></div>').appendTo(e),t=o.uc2007||"Missing",n.html(`<p>Stabilized Units in 2007: <strong>${t}</strong></p>`),n=$('<div class="popup-content"></div>').appendTo(e),t=o.uc2019||"Missing",n.html(`<p>Stabilized Units in 2019: <strong>${t}</strong></p>`),n=$('<div class="popup-content"></div>').appendTo(e),t=o.uc2020||"Missing",n.html(`<p>Stabilized Units in 2020: <strong>${t}</strong></p>`),n=$('<div class="popup-content"></div>').appendTo(e),t=o.uc2021||"Missing",n.html(`<p>Stabilized Units in 2021: <strong>${t}</strong></p>`);let s=+o.uc2021,a=+o.uc2019,l=(s-a)/a;o.missing==="True"?$('<div class="popup-content"><p><strong>This property has not registered stabilized units since 2019.</strong></p></div>').appendTo(e):s&&a?(n=$('<div class="popup-content"></div>').appendTo(e),l=l.toLocaleString("en-US",{style:"percent",minimumFractionDigits:0,maximumFractionDigits:0})||"N/A",n.html(`<p>Percent Change since 2019: <strong>${l}</strong></p>`)):l="N/A"}function _(o,e){let n=$('<div class="popup-content"></div>').appendTo(e),t=o.numbldgs||"N/A";if(n.html(`<p>Number of Buildings: <strong>${t}</strong></p>`),n=$('<div class="popup-content"></div>').appendTo(e),t=o.unitsres||"0",n.html(`<p>Residential Units: <strong>${t}</strong></p>`),n=$('<div class="popup-content"></div>').appendTo(e),t=o.unitscomm||"0",n.html(`<p>Commercial Units: <strong>${t}</strong></p>`),n=$('<div class="popup-content"></div>').appendTo(e),t=o.sale_date||"N/A",t!="N/A"){const s=t.split("-");t=`${s[1]}/${s[2]}/${s[0]}`}n.html(`<p>Sale Date: <strong>${t}</strong></p>`),n=$('<div class="popup-content"></div>').appendTo(e),t=o.sale_price||"N/A",t!="N/A"&&(t=t.toLocaleString("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0})),n.html(`<p>Sale Price: <strong>${t}</strong></p>`),n=$('<div class="popup-content"></div>').appendTo(e),t=o.ppuval||"N/A",t!="N/A"&&(t=t.toLocaleString("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0})),n.html(`<p>Price per Unit: <strong>${t}</strong></p>`)}function x(o,e){let n=$('<div class="popup-content"></div>').appendTo(e),t=o.numbldgs||"N/A";n.html(`<p>Number of Buildings: <strong>${t}</strong></p>`),n=$('<div class="popup-content"></div>').appendTo(e),t=o.unitsres||"0",n.html(`<p>Residential Units: <strong>${t}</strong></p>`),n=$('<div class="popup-content"></div>').appendTo(e),t=o.unitscomm||"0",n.html(`<p>Commercial Units: <strong>${t}</strong></p>`),n=$('<div class="popup-content"></div>').appendTo(e),t=o.violations||"0",n.html(`<p>Open Class C Violations: <strong>${t}</strong></p>`)}function P(o,e){let n=$('<div class="popup-content"></div>').appendTo(e),t=o.numbldgs||"N/A";n.html(`<p>Number of Buildings: <strong>${t}</strong></p>`),n=$('<div class="popup-content"></div>').appendTo(e),t=o.unitsres||"0",n.html(`<p>Residential Units: <strong>${t}</strong></p>`),n=$('<div class="popup-content"></div>').appendTo(e),t=o.unitscomm||"0",n.html(`<p>Commercial Units: <strong>${t}</strong></p>`),n=$('<div class="popup-content"></div>').appendTo(e),t=o.evictions||"0",n.html(`<p>Evictions: <strong>${t}</strong></p>`)}function T(){const o={forwardGeocode:async e=>{const n=[];return new Promise(async t=>{try{let s="https://geosearch.planninglabs.nyc/v2/autocomplete?text="+e.query;const l=await(await fetch(s)).json();for(let c of l.features){let d={type:"Feature",geometry:{type:"Point",coordinates:[c.geometry.coordinates[0],c.geometry.coordinates[1]]},place_name:c.properties.label,properties:c.properties,text:c.properties.label,place_type:["place"],center:[c.geometry.coordinates[0],c.geometry.coordinates[1]]};n.push(d)}}catch(s){console.error(`Failed to forwardGeocode with error: ${s}`)}t({features:n})})}};i.map.addControl(new MaplibreGeocoder(o,{maplibregl,placeholder:"Search address",minLength:3,showResultsWhileTyping:!0,bbox:[-74.63172,40.2295,-72.047772,41.57307]}),"top-left")}function u(o,e=[[],[]]){for(var n=0;n<o.length;n++)if(Array.isArray(o[n][0][0]))e=u(o[n],e);else{const s=o[n];for(var t=0;t<s.length;t++){const a=s[t][0],l=s[t][1];e[0][0]=e[0][0]<a?e[0][0]:a,e[1][0]=e[1][0]>a?e[1][0]:a,e[0][1]=e[0][1]<l?e[0][1]:l,e[1][1]=e[1][1]>l?e[1][1]:l}}return e}
